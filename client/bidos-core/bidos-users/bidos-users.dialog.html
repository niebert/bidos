<md-dialog aria-label="create-or-edit-user-dialog">

	<md-subheader ng-hide="vm.errorMessage" class="md-sticky-no-effect dialog-header">
		<span ng-if="!vm.user.id">Neuen Benutzer erstellen</span>
		<span ng-if="vm.user.id">Benutzer bearbeiten</span>
	</md-subheader>
	<md-subheader ng-show="vm.errorMessage" class="md-sticky-no-effect dialog-header server-error">Fehler: {{ vm.errorMessage }}</md-subheader>

	<md-content flex layout="column">

		<form name="userForm">
			<md-content layout="column">

				<div class="input-group">
					<md-input-group class="md-default-theme">
						<label for="name">Vor- und Nachname</label>
						<md-input type="text" id="name" name="name" ng-model="vm.user.name" required ng-pattern="/^.* .*$/"></md-input>
					</md-input-group>
					<div ng-show="userForm.name.$dirty" ng-messages="userForm.name.$error">
						<div class="error-message" ng-message="required">Sie müssen einen Namen angeben</div>
						<div class="error-message" ng-message="pattern">Geben Sie den Namen im Format <em>Vorname</em> <em>Nachname</em> an</div>
					</div>
				</div>

				<div class="input-group">
					<md-input-group class="md-default-theme">
						<label for="email">E-Mail-Adresse</label>
						<md-input type="email" id="email" name="email" ng-model="vm.user.email" required></md-input>
					</md-input-group>
					<div ng-show="userForm.email.$dirty" ng-messages="userForm.email.$error">
						<div class="error-message" ng-message="required">Sie müssen eine E-Mail-Adresse angeben</div>
						<div class="error-message" ng-message="email">Ungültige E-Mail-Adresse</div>
					</div>
				</div>

				<div class="input-group" ng-if="vm.user.id">
					<md-input-group class="md-default-theme">
						<label for="password">Passwort</label>
						<md-input type="password" id="password" name="password" ng-model="vm.user.password"></md-input>
					</md-input-group>
					<div ng-show="userForm.password.$dirty" ng-messages="userForm.password.$error">
						<div class="error-message" ng-message="required">Sie müssen ein Passwort angeben</div>
						<div class="error-message" ng-message="minlength">Passwort zu kurz (mindestens 5 Zeichen)</div>
					</div>
				</div>

				<div class="input-group" ng-if="!vm.user.id">
					<md-input-group class="md-default-theme">
						<label for="password">Passwort</label>
						<md-input type="password" id="password" name="password" ng-model="vm.user.password" required ng-minlength="5"></md-input>
					</md-input-group>
					<div ng-show="userForm.password.$dirty" ng-messages="userForm.password.$error">
						<div class="error-message" ng-message="required">Sie müssen ein Passwort angeben</div>
						<div class="error-message" ng-message="minlength">Passwort zu kurz (mindestens 5 Zeichen)</div>
					</div>
				</div>

				<div class="input-group">
					<md-input-group class="md-default-theme">
						<label for="institution">Institution (optional)</label>
						<md-input type="text" id="institution" name="institution" ng-model="vm.user.institution"></md-input>
					</md-input-group>
					<div ng-show="userForm.institution.$dirty" ng-messages="userForm.institution.$error">
					</div>
				</div>

				<div class="input-group">
					<span>Status:</span>
					<select name="status" ng-model="vm.user.status">
						<option value="-1">deaktiviert</option>
						<option value="0">aktiviert</option>
						<option value="1" selected>ausstehend</option>
					</select>
					<div ng-show="userForm.status.$dirty" ng-messages="userForm.status.$error">
						<div class="error-message" ng-message="required">Sie müssen einen Status auswählen</div>
					</div>
				</div>

				<div class="input-group">
					<span>Rolle:</span>
					<select ng-model="vm.user.role_id">
						<option value="1" selected>Praktiker</option>
						<option value="2">Wissenschaftler</option>
					</select>
				</div>

				<div class="input-group">
					<span>Gruppe:</span>
					<select ng-model="vm.user.group_id" ng-options="group.id as group.name for group in vm.data.groups"></select>
				</div>

			</md-content>
		</form>
	</md-content>

	<div class="md-actions" layout="row">

		<md-button ng-show="vm.user.id" ng-click="vm.destroy(vm.user)" class="md-raised md-warn">
			Löschen
		</md-button>

		<span flex></span>

		<md-button ng-click="vm.cancel()" class="md-raised">
			Abbrechen
		</md-button>

		<md-button ng-click="vm.save(vm.user)" class="md-raised md-primary md-button" ng-disabled="!vm.formIsValid(vm.user)">
			Speichern
		</md-button>
	</div>

</md-dialog>

<script type="text/ng-template" id="name-messages">
</script>
